# Avatar-Engine Neo4j Data Model Documentation

## Overview
The Avatar-Engine uses a sophisticated graph database model in Neo4j to represent conversations, relationships, and personality profiles. The model consists of 19 node types and 17 relationship types organized into five logical groups.

## Node Types

### 1. Core Data Nodes
These nodes represent the fundamental message data imported from external sources.

#### Person
- **Description**: Represents individual conversation participants
- **Properties**:
  - `id` (String, unique): Unique identifier (e.g., "person_1234567890")
  - `name` (String): Full name of the person
  - `phone` (String): Phone number
  - `isMainUser` (Boolean): Whether this is the primary user

#### Message
- **Description**: Individual messages in conversations
- **Properties**:
  - `id` (String, unique): Unique message identifier
  - `body` (String): Cleaned message text content
  - `date` (String): Timestamp of the message
  - `isFromMe` (Boolean): Whether message was sent by the main user
  - `groupChat` (String): Associated group chat ID

#### GroupChat
- **Description**: Conversation groups or chat rooms
- **Properties**:
  - `id` (String, unique): Unique group identifier
  - `name` (String): Human-readable group name

### 2. Profile Nodes
These nodes store comprehensive avatar profiles generated by the system.

#### CommunicationProfile
- **Description**: Main avatar profile containing communication analysis
- **Properties**:
  - `id` (String, unique): Profile identifier
  - `personId` (String): Associated person ID
  - `personName` (String): Person's name
  - `status` (String): Profile status (active/inactive)
  - `lastAnalysis` (DateTime): Last analysis timestamp
  - `messageCount` (Integer): Total messages analyzed
  - `avgMessageLength` (Float): Average message length
  - `responseStyle` (String): Communication style (concise/detailed)
  - `formalityScore` (Float): Formality level (0.0-1.0)
  - `emotionalExpressions` (String): JSON of emotional patterns

#### PersonalityProfile
- **Description**: LLM-generated personality analysis
- **Properties**:
  - `id` (String, unique): Profile identifier
  - `traits` (String): Personality traits analysis
  - `confidence` (Float): Analysis confidence score

#### CommunicationStyle
- **Description**: Detailed communication style patterns
- **Properties**:
  - `id` (String, unique): Style identifier
  - `patterns` (String): Communication patterns
  - `preferences` (String): Communication preferences

### 3. Analysis Nodes
These nodes store results from various analysis engines.

#### RelationshipDynamic
- **Description**: Analysis of relationship dynamics between people
- **Properties**:
  - `id` (String, unique): Dynamic identifier
  - `type` (String): Relationship type
  - `strength` (Float): Relationship strength score

#### LLMAnalysis
- **Description**: Claude AI analysis results
- **Properties**:
  - `id` (String, unique): Analysis identifier
  - `model` (String): AI model used
  - `analysis` (String): Analysis content
  - `timestamp` (DateTime): Analysis timestamp
  - `cost` (Float): API cost

#### SemanticCluster
- **Description**: Semantic groupings of related conversations
- **Properties**:
  - `id` (String, unique): Cluster identifier
  - `topic` (String): Cluster topic
  - `keywords` (String): Associated keywords

#### TopicAnalysis
- **Description**: Extracted topics and themes
- **Properties**:
  - `id` (String, unique): Analysis identifier
  - `topics` (String): Identified topics
  - `relevance` (Float): Topic relevance score

### 4. Pattern Nodes
These nodes capture recurring patterns in communication.

#### RelationshipPattern
- **Description**: Patterns in relationships with specific people
- **Properties**:
  - `id` (String, unique): Pattern identifier
  - `partnerId` (String): Partner's person ID
  - `partnerName` (String): Partner's name
  - `relationshipType` (String): Type (family/friend/romantic/professional)
  - `confidence` (Float): Confidence score
  - `messageCount` (Integer): Messages exchanged

#### SignaturePhrase
- **Description**: Characteristic phrases used by a person
- **Properties**:
  - `id` (String, unique): Phrase identifier
  - `phrase` (String): The actual phrase
  - `frequency` (Integer): Usage frequency
  - `context` (String): Usage context

#### StylePattern
- **Description**: Communication style patterns
- **Properties**:
  - `id` (String, unique): Pattern identifier
  - `contextType` (String): Context where pattern appears
  - `pattern` (String): The style pattern

#### TopicPreference
- **Description**: Preferred conversation topics
- **Properties**:
  - `id` (String, unique): Preference identifier
  - `topic` (String): Topic name
  - `frequency` (Integer): Discussion frequency

#### EmotionalExpression
- **Description**: Emotional expression patterns
- **Properties**:
  - `id` (String, unique): Expression identifier
  - `emotion` (String): Emotion type
  - `intensity` (Float): Expression intensity

#### TemporalPattern
- **Description**: Time-based communication patterns
- **Properties**:
  - `id` (String, unique): Pattern identifier
  - `timeFrame` (String): Time period
  - `activity` (String): Communication activity level

#### ContextTrigger
- **Description**: Context-based behavior triggers
- **Properties**:
  - `id` (String, unique): Trigger identifier
  - `context` (String): Trigger context
  - `response` (String): Typical response

### 5. System Nodes
These nodes store system metadata and configuration.

#### AvatarSystem
- **Description**: System metadata and statistics
- **Properties**:
  - `id` (String): System identifier
  - `version` (String): System version
  - `deploymentDate` (DateTime): Deployment timestamp
  - `status` (String): System status
  - `totalProfiles` (Integer): Total profiles created
  - `totalArtifacts` (Integer): Total artifacts generated

#### LLMSystem
- **Description**: LLM integration configuration
- **Properties**:
  - `id` (String): System identifier
  - `version` (String): LLM version
  - `supportedModels` (List): Available models
  - `status` (String): Integration status

## Relationship Types

### Core Relationships
- `(Person)-[:SENT]->(Message)`: Person sent a message
- `(Message)-[:SENT_TO]->(GroupChat)`: Message was sent to a group
- `(Person)-[:MEMBER_OF]->(GroupChat)`: Person is a member of a group

### Profile Relationships
- `(Person)-[:HAS_PROFILE]->(CommunicationProfile)`: Person has a communication profile
- `(Person)-[:HAS_PERSONALITY]->(PersonalityProfile)`: Person has a personality profile
- `(CommunicationProfile)-[:HAS_STYLE]->(CommunicationStyle)`: Profile has a communication style

### Analysis Relationships
- `(CommunicationProfile)-[:HAS_DYNAMIC]->(RelationshipDynamic)`: Profile has relationship dynamics
- `(CommunicationProfile)-[:ANALYZED_BY]->(LLMAnalysis)`: Profile was analyzed by LLM
- `(Message)-[:BELONGS_TO]->(SemanticCluster)`: Message belongs to semantic cluster
- `(CommunicationProfile)-[:HAS_ANALYSIS]->(TopicAnalysis)`: Profile has topic analysis

### Pattern Relationships
- `(CommunicationProfile)-[:HAS_RELATIONSHIP]->(RelationshipPattern)`: Profile has relationship patterns
- `(CommunicationProfile)-[:USES_PHRASE]->(SignaturePhrase)`: Profile uses signature phrases
- `(CommunicationProfile)-[:HAS_STYLE_PATTERN]->(StylePattern)`: Profile has style patterns
- `(CommunicationProfile)-[:PREFERS_TOPIC]->(TopicPreference)`: Profile has topic preferences
- `(CommunicationProfile)-[:EXPRESSES_EMOTION]->(EmotionalExpression)`: Profile expresses emotions
- `(CommunicationProfile)-[:HAS_TEMPORAL_PATTERN]->(TemporalPattern)`: Profile has temporal patterns
- `(CommunicationProfile)-[:HAS_TRIGGER]->(ContextTrigger)`: Profile has context triggers

## Query Examples

### Find all messages from a person
```cypher
MATCH (p:Person {name: "John Doe"})-[:SENT]->(m:Message)
RETURN m.body, m.date
ORDER BY m.date DESC
LIMIT 100
```

### Get relationship patterns for a person
```cypher
MATCH (p:Person {name: "John Doe"})-[:HAS_PROFILE]->(cp:CommunicationProfile)
MATCH (cp)-[:HAS_RELATIONSHIP]->(rp:RelationshipPattern)
RETURN rp.partnerName, rp.relationshipType, rp.confidence
ORDER BY rp.confidence DESC
```

### Find signature phrases
```cypher
MATCH (p:Person {name: "John Doe"})-[:HAS_PROFILE]->(cp:CommunicationProfile)
MATCH (cp)-[:USES_PHRASE]->(sp:SignaturePhrase)
RETURN sp.phrase, sp.frequency
ORDER BY sp.frequency DESC
```

### Analyze group dynamics
```cypher
MATCH (gc:GroupChat)<-[:MEMBER_OF]-(p:Person)
WITH gc, collect(p.name) as members, count(p) as memberCount
MATCH (m:Message)-[:SENT_TO]->(gc)
RETURN gc.name, members, memberCount, count(m) as messageCount
ORDER BY messageCount DESC
```

## Data Flow

1. **Data Import**: Messages are imported via `message_data_loader.py`
2. **Entity Creation**: Person, Message, and GroupChat nodes are created
3. **Relationship Mapping**: SENT, SENT_TO, and MEMBER_OF relationships established
4. **Profile Generation**: Avatar intelligence pipeline creates CommunicationProfile
5. **Pattern Detection**: Various patterns are extracted and linked to profiles
6. **LLM Analysis**: Optional Claude AI analysis adds deeper insights
7. **Avatar Generation**: Complete profiles enable personalized AI responses

## Constraints and Indexes

The system maintains data integrity through constraints:
- Unique constraints on all `id` properties
- Indexes on frequently queried properties (personId, status, etc.)
- Composite indexes for complex queries

## Performance Considerations

- **Node Count**: System handles 100K+ Person nodes efficiently
- **Message Volume**: Optimized for millions of Message nodes
- **Query Performance**: Indexed properties ensure sub-second query times
- **Batch Processing**: Data loader processes in configurable batches (default: 1000)

## Future Enhancements

Planned additions to the data model:
- `SentimentScore` node for sentiment analysis
- `ConversationThread` for threaded discussions
- `MediaAttachment` for images/videos
- `Location` for geographic context
- `Event` for calendar integration
